<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maintenance Breakdown Report</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <header>
            <div class="flex-column">
                <img id="logo" src="img/logo.png" alt="GWB Logo">
                <h1>CREATE A NEW REPORT</h1>
            </div>
        </header>
        <div class="div-button-create-report">
            <a class="button-create-report" href="index.html">Return to home</a>
        </div>
        <div class="space-top">
            <form id="reportForm">
                <div class="width-100">
                    <label for="title">Title:</label>
                    <input class="dimensions-form" type="text" id="title" name="title" maxlength="45">
                    <div class="char-count" id="charCount">0/45</div>
                </div>

                <div class="width-49 space-top">
                    <label for="date">Date:</label>
                    <input class="dimensions-form" type="date" id="date" name="date">
                </div>

                <div class="width-2"></div>

                <div class="width-49 div-dimensions-form space-top">
                    <label for="shift">Shift:</label>
                    <select class="dimensions-form" id="sift" name="shift">
                        <option value="">Select Shift</option>
                        <option value="M">Morning Shift</option>
                        <option value="A">Afternoon Shift</option>
                        <option value="N">Night Shift</option>
                    </select>
                </div>

                <div class="width-49 space-top">
                    <label for="lineMachine">Line or Machine:</label>
                    <input class="dimensions-form" type="text" id="line_machine" name="line_machine">
                </div>

                <div class="width-2"></div>

                <div class="width-49 space-top flex-column center">
                    <label for="code">Code:</label>
                    <div class="flex-row checkbox-wrapper-25 space-top">
                        <label id="code1" for="code1">Code 1</label>
                        <input type="checkbox" id="code" name="code" onclick="checkCodeInterlock()">
                        <label id="code2" for="code2">Code 2</label>
                    </div>
                </div>

                <div class="width-100 space-top">
                    <label for="description">Fault Description:</label>
                    <textarea class="dimensions-form dimensions-form-textarea" rows="5" id="description"
                        name="description"></textarea>
                </div>

                <div class="width-49 space-top">
                    <label for="number_people">Number of People:</label>
                    <input class="dimensions-form" type="number" id="number_people" name="number_people">
                </div>

                <div class="width-2"></div>

                <div class="width-49 space-top">
                    <label for="time_spend">Time Spent on this Job (minutes):</label>
                    <input class="dimensions-form" type="number" id="time_spend" min="0" name="time_spend">
                </div>

                <div class="width-49 space-top flex-row align-right">
                    <button id="submit" type="submit">Submit Data</button>
                </div>

                <div class="width-2"></div>

                <div class="width-49 space-top flex-row align-left">
                    <button type="reset" id="resetButton" onclick="confirmReset()">Reset Data</button>
                </div>

            </form>
        </div>
    </div>
</body>

<script>
    const input = document.getElementById('title');
    const charCount = document.getElementById('charCount');

    input.addEventListener('input', () => {
        const length = input.value.length;
        charCount.textContent = `${length}/45`;

        if (length > 45) {
            charCount.classList.add('over-limit');
        } else {
            charCount.classList.remove('over-limit');
        }
    });

    function checkCodeInterlock() {
        var code = document.getElementById("code");
        var code1 = document.getElementById("code1");
        var code2 = document.getElementById("code2");
        if (code.checked) {
            code1.style.display = "none";
            code2.style.display = "flex";
        } else {
            code1.style.display = "flex";
            code2.style.display = "none";
        }
    }

    async function submitForm(event) {
        event.preventDefault(); // Impede o envio padrão do formulário

        var form = document.getElementById("reportForm");
        var formData = new FormData(form);

        // Verifica o estado da checkbox e ajusta o valor do campo "code" conforme necessário
        var codeChecked = document.getElementById("code").checked;
        formData.set("code", codeChecked ? "2" : "1");

        // Prepara os dados para envio na API
        var data = {};
        formData.forEach((value, key) => {
            data[key] = value;
        });

        try {
            let response = await fetch("http://127.0.0.1:8000/api/maintenancereport/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                let result = await response.json();
                console.log("Success:", result);
                // Ações em caso de sucesso, como exibir uma mensagem ou redirecionar
            } else {
                console.error("Error:", response.statusText);
                // Ações em caso de erro, como exibir uma mensagem de erro
            }
        } catch (error) {
            console.error("Fetch error:", error);
            // Ações em caso de erro de rede ou outros
        }
    }

    document.getElementById("reportForm").addEventListener("submit", submitForm);

    checkCodeInterlock();
</script>

</html>